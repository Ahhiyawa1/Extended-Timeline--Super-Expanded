# Anti-Blobbing Mechanic with Province Requirement
namespace = anti_blobbing

# Main event to trigger the rebellion based on province count and date
country_event = {
    id = anti_blobbing.1
    title = "Our Country Strains Under Its Own Weight"
    desc = "Our country has grown too large, and it has become increasingly difficult to manage. Regions that were once loyal now seek their own freedom, and rebellion is imminent."

    trigger = {
        # Check if the country has more than 20 provinces (before 1871 AD)
        OR = {
            num_of_provinces = 10
            AND = {
                num_of_provinces = 23
                year = 3970
            }
        }
        NOT = { has_country_modifier = anti_blobbing_cooldown } # Prevents spam by adding cooldown
        OR = {
            tag = ROM # First Collapse Tag
            # Add other country tags here
        }
    }

    mean_time_to_happen = {
        months = 12 # More frequent revolts (occurs every year or so)
        modifier = {
            factor = 0.8 # Increase frequency
            overextension_percentage = 0.7 # More frequent if overextended
        }
        modifier = {
            factor = 0.7
            stability = -1 # Higher chance if stability is low
        }
        modifier = {
            factor = 1.3
            num_of_rebel_controlled_provinces = 1 # Less frequent if rebellion is ongoing
        }
    }

    option = {
        name = "The  Must Hold Together!"
        add_stability = -1
        add_country_modifier = {
            name = "anti_blobbing_cooldown"
            duration = 180 # 6-month cooldown to prevent spam
        }
        create_rebels = {
            size = 0.30 # Rebel size is proportional to the country size
            rebel_type = particularists # Can adjust rebel type
        }
    }

    option = {
        name = "Rebellion Runs Rampant!"
        add_stability = -2
        add_country_modifier = {
            name = "anti_blobbing_cooldown"
            duration = 180 # 6-month cooldown
        }
        random_owned_province = {
            limit = {
                has_core = yes
                is_core_of = { NOT = { is_active = yes } } # Release provinces with inactive tags that have a core
            }
            release_province_as_vassal = yes
        }
        random_owned_province = {
            limit = { development = 10 } # Higher development provinces are more likely to rebel
            create_rebels = {
                size = 0.5
                rebel_type = separatists
            }
        }
    }

    option = {
        name = "The Empire Fractures, New Nations Emerge!"
        add_stability = -3
        add_country_modifier = {
            name = "anti_blobbing_cooldown"
            duration = 180 # 6-month cooldown
        }
        every_owned_province = {
            limit = {
                has_core = yes
                is_core_of = { NOT = { is_active = yes } } # Provinces with inactive cores become independent
            }
            release_vassal = {
                tag = PREV # Tag of the released nation (based on the core)
                is_independent = yes
            }
        }
    }
}
