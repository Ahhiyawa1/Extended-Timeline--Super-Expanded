namespace = SM_library_of_muslim_schools_events
namespace = SM_grand_caravan_trading_square_events
namespace = SM_the_caliphate_great_hall_events
namespace = SM_garden_metropolis_events
#Library of Islamic Schools
country_event = { #Choose province
	id = SM_library_of_muslim_schools_events.0
	title = SM_library_of_muslim_schools_events.spawn_title
	desc = SM_library_of_muslim_schools_events.spawn_desc
	picture = FARMING_eventPicture
	is_triggered_only = yes
	major = yes
	major_trigger = {
		knows_country = ROOT
	}
	immediate = {
		hidden_effect = {
			set_country_flag = SM_spawn_event_open_flag
			every_owned_province = {
				limit = { SM_library_of_muslim_schools_province_triggers = yes }
				set_province_flag = SM_valid_province_flag
			}
			SM_set_spawn_target_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_1.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_spawn_target_1
				event_target:SM_spawn_target_1 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		goto = SM_spawn_target_1
		event_target:SM_spawn_target_1 = {
			SM_library_of_muslim_schools_spawn_province_effects = yes
		}
		SM_library_of_muslim_schools_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_2.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_2
			event_target:SM_spawn_target_2 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_2
		event_target:SM_spawn_target_2 = {
			SM_library_of_muslim_schools_spawn_province_effects = yes
		}
		SM_library_of_muslim_schools_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_3.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_3
			event_target:SM_spawn_target_3 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_3
		event_target:SM_spawn_target_3 = {
			SM_library_of_muslim_schools_spawn_province_effects = yes
		}
		SM_library_of_muslim_schools_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_4.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_4
			event_target:SM_spawn_target_4 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_4
		event_target:SM_spawn_target_4 = {
			SM_library_of_muslim_schools_spawn_province_effects = yes
		}
		SM_library_of_muslim_schools_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_5.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_5
			event_target:SM_spawn_target_5 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_5
		event_target:SM_spawn_target_5 = {
			SM_library_of_muslim_schools_spawn_province_effects = yes
		}
		SM_library_of_muslim_schools_spawn_country_effects = yes
	}
	option = {
		name = SM.choose_other_province
		highlight = yes
		trigger = {
			hidden_trigger = {
				SM_other_potential_province_exists_triggers = yes
			}
		}
		hidden_effect = {
			event_target:SM_spawn_target_1 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_2 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_3 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_4 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_5 = { set_province_flag = SM_skip_target_flag }
			country_event = {
				id = SM_library_of_muslim_schools_events.1
			}
		}
	}
	option = {
		name = SM.choose_other_province
		highlight = yes
		trigger = {
			hidden_trigger = {
				NOT = { SM_other_potential_province_exists_triggers = yes }
				calc_true_if = {
					all_owned_province = {
						SM_library_of_muslim_schools_province_triggers = yes
					}
					amount = 6
				}
			}
		}
		hidden_effect = {
			every_owned_province = {
				clr_province_flag = SM_skip_target_flag
			}
			country_event = {
				id = SM_library_of_muslim_schools_events.1
			}
		}
	}
	after = {
		every_owned_province = { 
			clr_province_flag = SM_skip_target_flag
			clr_province_flag = SM_valid_province_flag
		}
		clr_country_flag = SM_spawn_event_open_flag
	}
}
country_event = { #Choose province
	id = SM_library_of_muslim_schools_events.1
	title = SM_library_of_muslim_schools_events.spawn_title
	desc = SM_library_of_muslim_schools_events.spawn_desc
	picture = FARMING_eventPicture
	is_triggered_only = yes
	major = yes
	major_trigger = {
		knows_country = ROOT
	}
	immediate = {
		hidden_effect = {
			set_country_flag = SM_spawn_event_open_flag
			every_owned_province = {
				limit = { SM_library_of_muslim_schools_province_triggers = yes }
				set_province_flag = SM_valid_province_flag
			}
			SM_set_spawn_target_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_1.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_spawn_target_1
				event_target:SM_spawn_target_1 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		goto = SM_spawn_target_1
		event_target:SM_spawn_target_1 = {
			SM_library_of_muslim_schools_spawn_province_effects = yes
		}
		SM_library_of_muslim_schools_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_2.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_2
			event_target:SM_spawn_target_2 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_2
		event_target:SM_spawn_target_2 = {
			SM_library_of_muslim_schools_spawn_province_effects = yes
		}
		SM_library_of_muslim_schools_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_3.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_3
			event_target:SM_spawn_target_3 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_3
		event_target:SM_spawn_target_3 = {
			SM_library_of_muslim_schools_spawn_province_effects = yes
		}
		SM_library_of_muslim_schools_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_4.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_4
			event_target:SM_spawn_target_4 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_4
		event_target:SM_spawn_target_4 = {
			SM_library_of_muslim_schools_spawn_province_effects = yes
		}
		SM_library_of_muslim_schools_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_5.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_5
			event_target:SM_spawn_target_5 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_5
		event_target:SM_spawn_target_5 = {
			SM_library_of_muslim_schools_spawn_province_effects = yes
		}
		SM_library_of_muslim_schools_spawn_country_effects = yes
	}
	option = {
		name = SM.choose_other_province
		highlight = yes
		trigger = {
			hidden_trigger = {
				SM_other_potential_province_exists_triggers = yes
			}
		}
		hidden_effect = {
			event_target:SM_spawn_target_1 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_2 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_3 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_4 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_5 = { set_province_flag = SM_skip_target_flag }
			country_event = {
				id = SM_library_of_muslim_schools_events.0
			}
		}
	}
	option = {
		name = SM.choose_other_province
		highlight = yes
		trigger = {
			hidden_trigger = {
				NOT = { SM_other_potential_province_exists_triggers = yes }
				calc_true_if = {
					all_owned_province = {
						SM_library_of_muslim_schools_province_triggers = yes
					}
					amount = 6
				}
			}
		}
		hidden_effect = {
			every_owned_province = {
				clr_province_flag = SM_skip_target_flag
			}
			country_event = {
				id = SM_library_of_muslim_schools_events.0
			}
		}
	}
	after = {
		every_owned_province = { 
			clr_province_flag = SM_skip_target_flag
			clr_province_flag = SM_valid_province_flag
		}
		clr_country_flag = SM_spawn_event_open_flag
	}
}
#Grand Caravan Trading Square
country_event = { #Choose trade node
	id = SM_grand_caravan_trading_square_events.0
	title = SM_grand_caravan_trading_square_events.spawn_title
	desc = SM_grand_caravan_trading_square_events.choose_trade_node
	picture = MERCHANTS_TALKING_eventPicture
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			set_country_flag = SM_spawn_event_open_flag
			random_trade_node = {
				limit = {
					SM_grand_caravan_trading_square_trade_node_triggers = yes
					any_trade_node_member_province = {
						SM_grand_caravan_trading_square_province_triggers = yes
					}
					NOT = { has_province_flag = SM_skip_target_flag }
				}
				save_event_target_as = SM_trade_node_target_1
			}
			if = {
				limit = {
					has_saved_event_target = SM_trade_node_target_1
					event_target:SM_trade_node_target_1 = {
						NOT = { has_province_flag = SM_skip_target_flag }
					}
				}
				random_trade_node = {
					limit = {
						SM_grand_caravan_trading_square_trade_node_triggers = yes
						any_trade_node_member_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
						NOT = { province_id = event_target:SM_trade_node_target_1 }
						NOT = { has_province_flag = SM_skip_target_flag }
					}
					save_event_target_as = SM_trade_node_target_2
				}
			}
			if = {
				limit = {
					has_saved_event_target = SM_trade_node_target_2
					event_target:SM_trade_node_target_2 = {
						NOT = { has_province_flag = SM_skip_target_flag }
					}
				}
				random_trade_node = {
					limit = {
						SM_grand_caravan_trading_square_trade_node_triggers = yes
						any_trade_node_member_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
						NOT = { province_id = event_target:SM_trade_node_target_1 }
						NOT = { province_id = event_target:SM_trade_node_target_2 }
						NOT = { has_province_flag = SM_skip_target_flag }
					}
					save_event_target_as = SM_trade_node_target_3
				}
			}
			if = {
				limit = {
					has_saved_event_target = SM_trade_node_target_3
					event_target:SM_trade_node_target_3 = {
						NOT = { has_province_flag = SM_skip_target_flag }
					}
				}
				random_trade_node = {
					limit = {
						SM_grand_caravan_trading_square_trade_node_triggers = yes
						any_trade_node_member_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
						NOT = { province_id = event_target:SM_trade_node_target_1 }
						NOT = { province_id = event_target:SM_trade_node_target_2 }
						NOT = { province_id = event_target:SM_trade_node_target_3 }
						NOT = { has_province_flag = SM_skip_target_flag }
					}
					save_event_target_as = SM_trade_node_target_4
				}
			}
			if = {
				limit = {
					has_saved_event_target = SM_trade_node_target_4
					event_target:SM_trade_node_target_4 = {
						NOT = { has_province_flag = SM_skip_target_flag }
					}
				}
				random_trade_node = {
					limit = {
						SM_grand_caravan_trading_square_trade_node_triggers = yes
						any_trade_node_member_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
						NOT = { province_id = event_target:SM_trade_node_target_1 }
						NOT = { province_id = event_target:SM_trade_node_target_2 }
						NOT = { province_id = event_target:SM_trade_node_target_3 }
						NOT = { province_id = event_target:SM_trade_node_target_4 }
						NOT = { has_province_flag = SM_skip_target_flag }
					}
					save_event_target_as = SM_trade_node_target_5
				}
			}
		}
	}
	option = {
		name = [SM_trade_node_target_1.GetTradeNodeName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_trade_node_target_1
				event_target:SM_trade_node_target_1 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		hidden_effect = {
			event_target:SM_trade_node_target_1 = {
				save_event_target_as = SM_trade_node_target
			}
		}
	}
	option = {
		name = [SM_trade_node_target_2.GetTradeNodeName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_trade_node_target_2
				event_target:SM_trade_node_target_2 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		hidden_effect = {
			event_target:SM_trade_node_target_2 = {
				save_event_target_as = SM_trade_node_target
			}
		}
	}
	option = {
		name = [SM_trade_node_target_3.GetTradeNodeName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_trade_node_target_3
				event_target:SM_trade_node_target_3 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		hidden_effect = {
			event_target:SM_trade_node_target_3 = {
				save_event_target_as = SM_trade_node_target
			}
		}
	}
	option = {
		name = [SM_trade_node_target_4.GetTradeNodeName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_trade_node_target_4
				event_target:SM_trade_node_target_4 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		hidden_effect = {
			event_target:SM_trade_node_target_4 = {
				save_event_target_as = SM_trade_node_target
			}
		}
	}
	option = {
		name = [SM_trade_node_target_5.GetTradeNodeName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_trade_node_target_5
				event_target:SM_trade_node_target_5 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		hidden_effect = {
			event_target:SM_trade_node_target_5 = {
				save_event_target_as = SM_trade_node_target
			}
		}
	}
	option = {
		name = SM.choose_other_country
		highlight = yes
		trigger = {
			hidden_trigger = {
				any_trade_node = {
					SM_grand_caravan_trading_square_trade_node_triggers = yes
					any_trade_node_member_province = {
						SM_grand_caravan_trading_square_province_triggers = yes
					}
					NOT = { has_province_flag = SM_skip_target_flag }
					NOT = {
						OR = {
							province_id = event_target:SM_trade_node_target_1
							province_id = event_target:SM_trade_node_target_2
							province_id = event_target:SM_trade_node_target_3
							province_id = event_target:SM_trade_node_target_4
							province_id = event_target:SM_trade_node_target_5
						}
					}
				}
			}
		}
		hidden_effect = {
			event_target:SM_trade_node_target_1 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_trade_node_target_2 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_trade_node_target_3 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_trade_node_target_4 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_trade_node_target_5 = { set_province_flag = SM_skip_target_flag }
		}
	}
	option = {
		name = SM.choose_other_country
		highlight = yes
		trigger = {
			hidden_trigger = {
				NOT = {
					any_trade_node = {
						SM_grand_caravan_trading_square_trade_node_triggers = yes
						any_trade_node_member_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
						NOT = { has_province_flag = SM_skip_target_flag }
						NOT = {
							OR = {
								province_id = event_target:SM_trade_node_target_1
								province_id = event_target:SM_trade_node_target_2
								province_id = event_target:SM_trade_node_target_3
								province_id = event_target:SM_trade_node_target_4
								province_id = event_target:SM_trade_node_target_5
							}
						}
					}
				}
				calc_true_if = {
					all_trade_node = {
						SM_grand_caravan_trading_square_trade_node_triggers = yes
						any_trade_node_member_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
					}
					amount = 6
				}
			}
		}
		hidden_effect = {
			every_subject_country = {
				clr_country_flag = SM_skip_target_flag
			}
		}
	}
	after = {
		while = {
			limit = { any_trade_node = { has_province_flag = SM_skip_target_flag } }
			random_trade_node = {
				clr_province_flag = SM_skip_target_flag
			}
		}
		if = {
			limit = { has_saved_event_target = SM_trade_node_target }
			country_event = {
				id = SM_grand_caravan_trading_square_events.2
			}
		}
		else = {
			country_event = {
				id = SM_grand_caravan_trading_square_events.1
			}
		}
	}
}
country_event = { #Choose trade node
	id = SM_grand_caravan_trading_square_events.1
	title = SM_grand_caravan_trading_square_events.spawn_title
	desc = SM_grand_caravan_trading_square_events.choose_trade_node
	picture = MERCHANTS_TALKING_eventPicture
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			set_country_flag = SM_spawn_event_open_flag
			random_trade_node = {
				limit = {
					SM_grand_caravan_trading_square_trade_node_triggers = yes
					any_trade_node_member_province = {
						SM_grand_caravan_trading_square_province_triggers = yes
					}
					NOT = { has_province_flag = SM_skip_target_flag }
				}
				save_event_target_as = SM_trade_node_target_1
			}
			if = {
				limit = {
					has_saved_event_target = SM_trade_node_target_1
					event_target:SM_trade_node_target_1 = {
						NOT = { has_province_flag = SM_skip_target_flag }
					}
				}
				random_trade_node = {
					limit = {
						SM_grand_caravan_trading_square_trade_node_triggers = yes
						any_trade_node_member_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
						NOT = { province_id = event_target:SM_trade_node_target_1 }
						NOT = { has_province_flag = SM_skip_target_flag }
					}
					save_event_target_as = SM_trade_node_target_2
				}
			}
			if = {
				limit = {
					has_saved_event_target = SM_trade_node_target_2
					event_target:SM_trade_node_target_2 = {
						NOT = { has_province_flag = SM_skip_target_flag }
					}
				}
				random_trade_node = {
					limit = {
						SM_grand_caravan_trading_square_trade_node_triggers = yes
						any_trade_node_member_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
						NOT = { province_id = event_target:SM_trade_node_target_1 }
						NOT = { province_id = event_target:SM_trade_node_target_2 }
						NOT = { has_province_flag = SM_skip_target_flag }
					}
					save_event_target_as = SM_trade_node_target_3
				}
			}
			if = {
				limit = {
					has_saved_event_target = SM_trade_node_target_3
					event_target:SM_trade_node_target_3 = {
						NOT = { has_province_flag = SM_skip_target_flag }
					}
				}
				random_trade_node = {
					limit = {
						SM_grand_caravan_trading_square_trade_node_triggers = yes
						any_trade_node_member_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
						NOT = { province_id = event_target:SM_trade_node_target_1 }
						NOT = { province_id = event_target:SM_trade_node_target_2 }
						NOT = { province_id = event_target:SM_trade_node_target_3 }
						NOT = { has_province_flag = SM_skip_target_flag }
					}
					save_event_target_as = SM_trade_node_target_4
				}
			}
			if = {
				limit = {
					has_saved_event_target = SM_trade_node_target_4
					event_target:SM_trade_node_target_4 = {
						NOT = { has_province_flag = SM_skip_target_flag }
					}
				}
				random_trade_node = {
					limit = {
						SM_grand_caravan_trading_square_trade_node_triggers = yes
						any_trade_node_member_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
						NOT = { province_id = event_target:SM_trade_node_target_1 }
						NOT = { province_id = event_target:SM_trade_node_target_2 }
						NOT = { province_id = event_target:SM_trade_node_target_3 }
						NOT = { province_id = event_target:SM_trade_node_target_4 }
						NOT = { has_province_flag = SM_skip_target_flag }
					}
					save_event_target_as = SM_trade_node_target_5
				}
			}
		}
	}
	option = {
		name = [SM_trade_node_target_1.GetTradeNodeName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_trade_node_target_1
				event_target:SM_trade_node_target_1 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		hidden_effect = {
			event_target:SM_trade_node_target_1 = {
				save_event_target_as = SM_trade_node_target
			}
		}
	}
	option = {
		name = [SM_trade_node_target_2.GetTradeNodeName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_trade_node_target_2
				event_target:SM_trade_node_target_2 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		hidden_effect = {
			event_target:SM_trade_node_target_2 = {
				save_event_target_as = SM_trade_node_target
			}
		}
	}
	option = {
		name = [SM_trade_node_target_3.GetTradeNodeName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_trade_node_target_3
				event_target:SM_trade_node_target_3 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		hidden_effect = {
			event_target:SM_trade_node_target_3 = {
				save_event_target_as = SM_trade_node_target
			}
		}
	}
	option = {
		name = [SM_trade_node_target_4.GetTradeNodeName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_trade_node_target_4
				event_target:SM_trade_node_target_4 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		hidden_effect = {
			event_target:SM_trade_node_target_4 = {
				save_event_target_as = SM_trade_node_target
			}
		}
	}
	option = {
		name = [SM_trade_node_target_5.GetTradeNodeName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_trade_node_target_5
				event_target:SM_trade_node_target_5 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		hidden_effect = {
			event_target:SM_trade_node_target_5 = {
				save_event_target_as = SM_trade_node_target
			}
		}
	}
	option = {
		name = SM.choose_other_country
		highlight = yes
		trigger = {
			hidden_trigger = {
				any_trade_node = {
					SM_grand_caravan_trading_square_trade_node_triggers = yes
					any_trade_node_member_province = {
						SM_grand_caravan_trading_square_province_triggers = yes
					}
					NOT = { has_province_flag = SM_skip_target_flag }
					NOT = {
						OR = {
							province_id = event_target:SM_trade_node_target_1
							province_id = event_target:SM_trade_node_target_2
							province_id = event_target:SM_trade_node_target_3
							province_id = event_target:SM_trade_node_target_4
							province_id = event_target:SM_trade_node_target_5
						}
					}
				}
			}
		}
		hidden_effect = {
			event_target:SM_trade_node_target_1 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_trade_node_target_2 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_trade_node_target_3 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_trade_node_target_4 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_trade_node_target_5 = { set_province_flag = SM_skip_target_flag }
		}
	}
	option = {
		name = SM.choose_other_country
		highlight = yes
		trigger = {
			hidden_trigger = {
				NOT = {
					any_trade_node = {
						SM_grand_caravan_trading_square_trade_node_triggers = yes
						any_trade_node_member_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
						NOT = { has_province_flag = SM_skip_target_flag }
						NOT = {
							OR = {
								province_id = event_target:SM_trade_node_target_1
								province_id = event_target:SM_trade_node_target_2
								province_id = event_target:SM_trade_node_target_3
								province_id = event_target:SM_trade_node_target_4
								province_id = event_target:SM_trade_node_target_5
							}
						}
					}
				}
				calc_true_if = {
					all_trade_node = {
						SM_grand_caravan_trading_square_trade_node_triggers = yes
						any_trade_node_member_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
					}
					amount = 6
				}
			}
		}
		hidden_effect = {
			every_subject_country = {
				clr_country_flag = SM_skip_target_flag
			}
		}
	}
	after = {
		while = {
			limit = { any_trade_node = { has_province_flag = SM_skip_target_flag } }
			random_trade_node = {
				clr_province_flag = SM_skip_target_flag
			}
		}
		if = {
			limit = { has_saved_event_target = SM_trade_node_target }
			country_event = {
				id = SM_grand_caravan_trading_square_events.2
			}
		}
		else = {
			country_event = {
				id = SM_grand_caravan_trading_square_events.0
			}
		}
	}
}
country_event = { #Choose province
	id = SM_grand_caravan_trading_square_events.2
	title = SM_grand_caravan_trading_square_events.spawn_title
	desc = SM_grand_caravan_trading_square_events.spawn_desc
	picture = TRADEGOODS_eventPicture
	is_triggered_only = yes
	major = yes
	major_trigger = {
		knows_country = ROOT
	}
	immediate = {
		hidden_effect = {
			event_target:SM_trade_node_target = {
				every_trade_node_member_province = {
					limit = {
						SM_grand_caravan_trading_square_province_triggers = yes
					}
				}
				set_province_flag = SM_valid_province_flag
			}
			SM_set_spawn_target_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_1.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_spawn_target_1
				event_target:SM_spawn_target_1 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		goto = SM_spawn_target_1
		event_target:SM_spawn_target_1 = {
			SM_grand_caravan_trading_square_spawn_province_effects = yes
		}
		SM_grand_caravan_trading_square_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_2.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_2
			event_target:SM_spawn_target_2 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_2
		event_target:SM_spawn_target_2 = {
			SM_grand_caravan_trading_square_spawn_province_effects = yes
		}
		SM_grand_caravan_trading_square_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_3.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_3
			event_target:SM_spawn_target_3 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_3
		event_target:SM_spawn_target_3 = {
			SM_grand_caravan_trading_square_spawn_province_effects = yes
		}
		SM_grand_caravan_trading_square_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_4.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_4
			event_target:SM_spawn_target_4 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_4
		event_target:SM_spawn_target_4 = {
			SM_grand_caravan_trading_square_spawn_province_effects = yes
		}
		SM_grand_caravan_trading_square_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_5.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_5
			event_target:SM_spawn_target_5 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_5
		event_target:SM_spawn_target_5 = {
			SM_grand_caravan_trading_square_spawn_province_effects = yes
		}
		SM_grand_caravan_trading_square_spawn_country_effects = yes
	}
	option = {
		name = SM.choose_other_province
		highlight = yes
		trigger = {
			hidden_trigger = {
				event_target:SM_country_target = {
					SM_other_potential_province_exists_triggers = yes
				}
			}
		}
		hidden_effect = {
			event_target:SM_spawn_target_1 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_2 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_3 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_4 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_5 = { set_province_flag = SM_skip_target_flag }
			country_event = {
				id = SM_grand_caravan_trading_square_events.3
			}
		}
	}
	option = {
		name = SM.choose_other_province
		highlight = yes
		trigger = {
			hidden_trigger = {
				event_target:SM_country_target = {
					NOT = { SM_other_potential_province_exists_triggers = yes }
					calc_true_if = {
						all_owned_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
						amount = 6
					}
				}
			}
		}
		hidden_effect = {
			every_owned_province = {
				clr_province_flag = SM_skip_target_flag
			}
			country_event = {
				id = SM_grand_caravan_trading_square_events.3
			}
		}
	}
	after = {
		every_owned_province = {
			clr_province_flag = SM_skip_target_flag
			clr_province_flag = SM_valid_province_flag
		}
		clr_country_flag = SM_spawn_event_open_flag
	}
}
country_event = { #Choose province
	id = SM_grand_caravan_trading_square_events.3
	title = SM_grand_caravan_trading_square_events.spawn_title
	desc = SM_grand_caravan_trading_square_events.spawn_desc
	picture = TRADEGOODS_eventPicture
	is_triggered_only = yes
	major = yes
	major_trigger = {
		knows_country = ROOT
	}
	immediate = {
		hidden_effect = {
			event_target:SM_trade_node_target = {
				every_trade_node_member_province = {
					limit = {
						SM_grand_caravan_trading_square_province_triggers = yes
					}
				}
				set_province_flag = SM_valid_province_flag
			}
			SM_set_spawn_target_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_1.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_spawn_target_1
				event_target:SM_spawn_target_1 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		goto = SM_spawn_target_1
		event_target:SM_spawn_target_1 = {
			SM_grand_caravan_trading_square_spawn_province_effects = yes
		}
		SM_grand_caravan_trading_square_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_2.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_2
			event_target:SM_spawn_target_2 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_2
		event_target:SM_spawn_target_2 = {
			SM_grand_caravan_trading_square_spawn_province_effects = yes
		}
		SM_grand_caravan_trading_square_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_3.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_3
			event_target:SM_spawn_target_3 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_3
		event_target:SM_spawn_target_3 = {
			SM_grand_caravan_trading_square_spawn_province_effects = yes
		}
		SM_grand_caravan_trading_square_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_4.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_4
			event_target:SM_spawn_target_4 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_4
		event_target:SM_spawn_target_4 = {
			SM_grand_caravan_trading_square_spawn_province_effects = yes
		}
		SM_grand_caravan_trading_square_spawn_country_effects = yes
	}
	option = {
		name = [SM_spawn_target_5.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_5
			event_target:SM_spawn_target_5 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_5
		event_target:SM_spawn_target_5 = {
			SM_grand_caravan_trading_square_spawn_province_effects = yes
		}
		SM_grand_caravan_trading_square_spawn_country_effects = yes
	}
	option = {
		name = SM.choose_other_province
		highlight = yes
		trigger = {
			hidden_trigger = {
				event_target:SM_country_target = {
					SM_other_potential_province_exists_triggers = yes
				}
			}
		}
		hidden_effect = {
			event_target:SM_spawn_target_1 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_2 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_3 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_4 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_5 = { set_province_flag = SM_skip_target_flag }
			country_event = {
				id = SM_grand_caravan_trading_square_events.2
			}
		}
	}
	option = {
		name = SM.choose_other_province
		highlight = yes
		trigger = {
			hidden_trigger = {
				event_target:SM_country_target = {
					NOT = { SM_other_potential_province_exists_triggers = yes }
					calc_true_if = {
						all_owned_province = {
							SM_grand_caravan_trading_square_province_triggers = yes
						}
						amount = 6
					}
				}
			}
		}
		hidden_effect = {
			every_owned_province = {
				clr_province_flag = SM_skip_target_flag
			}
			country_event = {
				id = SM_grand_caravan_trading_square_events.2
			}
		}
	}
	after = {
		every_owned_province = {
			clr_province_flag = SM_skip_target_flag
			clr_province_flag = SM_valid_province_flag
		}
		clr_country_flag = SM_spawn_event_open_flag
	}
}
#The Caliphate Great Hall
country_event = { #Spawn in capital
	id = SM_the_caliphate_great_hall_events.0
	title = SM_the_caliphate_great_hall_events.spawn_title
	desc = SM_the_caliphate_great_hall_events.spawn_desc
	picture = FORT_eventPicture
	is_triggered_only = yes
	major = yes
	major_trigger = {
		knows_country = ROOT
	}
	immediate = {
		hidden_effect = {
			set_country_flag = SM_spawn_event_open_flag
		}
	}
	option = {
		name = SM.wonderful_news
		ai_chance = {
			factor = 1
		}
		hidden_effect = { set_global_flag = SM_the_caliphate_great_hall_spawned_global_flag }
		capital_scope = {
			add_great_project = {
				type = SM_the_caliphate_great_hall
				instant = yes
			}
		}
		random_list = {
			1 = { trigger = { NOT = { ADM = 6 } } change_adm = 1 }
			1 = { trigger = { NOT = { DIP = 6 } } change_dip = 1 }
			1 = { trigger = { NOT = { MIL = 6 } } change_mil = 1 }
		}
	}
	after = {
		clr_country_flag = SM_spawn_event_open_flag
	}
}
#Garden Metropolis
country_event = { #Choose province
	id = SM_garden_metropolis_events.0
	title = SM_garden_metropolis_events.spawn_title
	desc = SM_garden_metropolis_events.spawn_desc
	picture = northamericagfx_CITY_VIEW_eventPicture
	is_triggered_only = yes
	major = yes
	major_trigger = {
		knows_country = ROOT
	}
	immediate = {
		hidden_effect = {
			set_country_flag = SM_spawn_event_open_flag
			every_owned_province = {
				limit = { SM_garden_metropolis_province_triggers = yes }
				set_province_flag = SM_valid_province_flag
			}
			SM_set_spawn_target_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_1.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_spawn_target_1
				event_target:SM_spawn_target_1 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		goto = SM_spawn_target_1
		event_target:SM_spawn_target_1 = {
			SM_garden_metropolis_spawn_province_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_2.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_2
			event_target:SM_spawn_target_2 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_2
		event_target:SM_spawn_target_2 = {
			SM_garden_metropolis_spawn_province_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_3.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_3
			event_target:SM_spawn_target_3 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_3
		event_target:SM_spawn_target_3 = {
			SM_garden_metropolis_spawn_province_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_4.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_4
			event_target:SM_spawn_target_4 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_4
		event_target:SM_spawn_target_4 = {
			SM_garden_metropolis_spawn_province_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_5.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_5
			event_target:SM_spawn_target_5 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_5
		event_target:SM_spawn_target_5 = {
			SM_garden_metropolis_spawn_province_effects = yes
		}
	}
	option = {
		name = SM.choose_other_province
		highlight = yes
		trigger = {
			hidden_trigger = {
				SM_other_potential_province_exists_triggers = yes
			}
		}
		hidden_effect = {
			event_target:SM_spawn_target_1 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_2 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_3 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_4 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_5 = { set_province_flag = SM_skip_target_flag }
			country_event = {
				id = SM_garden_metropolis_events.1
			}
		}
	}
	option = {
		name = SM.choose_other_province
		highlight = yes
		trigger = {
			hidden_trigger = {
				NOT = { SM_other_potential_province_exists_triggers = yes }
				calc_true_if = {
					all_owned_province = {
						SM_garden_metropolis_province_triggers = yes
					}
					amount = 6
				}
			}
		}
		hidden_effect = {
			every_owned_province = {
				clr_province_flag = SM_skip_target_flag
			}
			country_event = {
				id = SM_garden_metropolis_events.1
			}
		}
	}
	after = {
		every_owned_province = { 
			clr_province_flag = SM_skip_target_flag
			clr_province_flag = SM_valid_province_flag
		}
		clr_country_flag = SM_spawn_event_open_flag
	}
}
country_event = { #Choose province
	id = SM_garden_metropolis_events.1
	title = SM_garden_metropolis_events.spawn_title
	desc = SM_garden_metropolis_events.spawn_desc
	picture = PRAYER_IN_MOSQUE_eventPicture
	is_triggered_only = yes
	major = yes
	major_trigger = {
		knows_country = ROOT
	}
	immediate = {
		hidden_effect = {
			set_country_flag = SM_spawn_event_open_flag
			every_owned_province = {
				limit = { SM_garden_metropolis_province_triggers = yes }
				set_province_flag = SM_valid_province_flag
			}
			SM_set_spawn_target_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_1.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			hidden_trigger = {
				has_saved_event_target = SM_spawn_target_1
				event_target:SM_spawn_target_1 = {
					NOT = { has_province_flag = SM_skip_target_flag }
				}
			}
		}
		goto = SM_spawn_target_1
		event_target:SM_spawn_target_1 = {
			SM_garden_metropolis_spawn_province_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_2.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_2
			event_target:SM_spawn_target_2 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_2
		event_target:SM_spawn_target_2 = {
			SM_garden_metropolis_spawn_province_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_3.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_3
			event_target:SM_spawn_target_3 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_3
		event_target:SM_spawn_target_3 = {
			SM_garden_metropolis_spawn_province_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_4.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_4
			event_target:SM_spawn_target_4 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_4
		event_target:SM_spawn_target_4 = {
			SM_garden_metropolis_spawn_province_effects = yes
		}
	}
	option = {
		name = [SM_spawn_target_5.GetName]
		ai_chance = {
			factor = 1
		}
		trigger = {
			has_saved_event_target = SM_spawn_target_5
			event_target:SM_spawn_target_5 = {
				NOT = { has_province_flag = SM_skip_target_flag }
			}
		}
		goto = SM_spawn_target_5
		event_target:SM_spawn_target_5 = {
			SM_garden_metropolis_spawn_province_effects = yes
		}
	}
	option = {
		name = SM.choose_other_province
		highlight = yes
		trigger = {
			hidden_trigger = {
				SM_other_potential_province_exists_triggers = yes
			}
		}
		hidden_effect = {
			event_target:SM_spawn_target_1 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_2 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_3 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_4 = { set_province_flag = SM_skip_target_flag }
			event_target:SM_spawn_target_5 = { set_province_flag = SM_skip_target_flag }
			country_event = {
				id = SM_garden_metropolis_events.0
			}
		}
	}
	option = {
		name = SM.choose_other_province
		highlight = yes
		trigger = {
			hidden_trigger = {
				NOT = { SM_other_potential_province_exists_triggers = yes }
				calc_true_if = {
					all_owned_province = {
						SM_garden_metropolis_province_triggers = yes
					}
					amount = 6
				}
			}
		}
		hidden_effect = {
			every_owned_province = {
				clr_province_flag = SM_skip_target_flag
			}
			country_event = {
				id = SM_garden_metropolis_events.0
			}
		}
	}
	after = {
		every_owned_province = { 
			clr_province_flag = SM_skip_target_flag
			clr_province_flag = SM_valid_province_flag
		}
		clr_country_flag = SM_spawn_event_open_flag
	}
}